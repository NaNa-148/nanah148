<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ספר המידות</title>
    <style>
        body {
            margin: 0;
            padding: 60px 5%;
            min-height: 100vh;
            background: linear-gradient(to bottom right, #0b1e2f, #1a2e4f);
            color: white;
            font-family: 'Arial', 'Narkis Block', 'David Libre', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .top-bar {
            position: fixed;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            box-sizing: border-box;
            z-index: 999;
            flex-wrap: wrap;
        }

        body.fullscreen-active .top-bar { /* Updated to use class on body */
            display: none !important;
        }

        .controls-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .top-text, .control-element {
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 5px;
            color: white;
            border: none;
            cursor: pointer;
        }
        .control-element select {
             background: transparent;
             color: white;
             border: none;
             padding: 2px;
        }
        .control-element option {
            background: #1a2e4f;
            color: white;
        }

        .content-display {
            max-width: 800px;
            width: 90%;
        }
        .topic-display, .letter-display, .text-display {
            margin-bottom: 15px;
            transition: opacity 0.5s ease-in-out;
        }
        .topic-display {
            font-size: calc(2.2em + 30px);
            font-weight: bold;
            color: white;
        }
        .letter-display {
            font-size: calc(1.8em + 10px);
            color: white;
        }
        .text-display {
            font-size: calc(1.6em + 10px);
            line-height: 1.8;
            min-height: 100px;
            color: white;
        }

        .nanach-signature {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            white-space: nowrap;
            font-family: 'David Libre', 'Narkis Block', serif;
            z-index: 1001;
        }

        .nanach-signature span {
            opacity: 0;
            animation: fadeIn依次 1s forwards;
        }

        .nanach-signature .s1 { color: white; animation-delay: 0.5s; }
        .nanach-signature .s2 { color: #FFD700; animation-delay: 1.0s; margin-right: 0.7em; }
        .nanach-signature .s3 { color: #FF7F50; animation-delay: 1.5s; margin-right: 0.7em; }
        .nanach-signature .s4 { color: #87CEEB; animation-delay: 2.0s; margin-right: 0.7em; }
        .nanach-signature .s5 {
            animation-delay: 2.5s; margin-right: 0.7em;
        }
        .nanach-signature .s5 .char1 { color: #FFDAB9; }
        .nanach-signature .s5 .char2 { color: #FFFF00; }
        .nanach-signature .s5 .char3 { color: #EE82EE; }
        .nanach-signature .s5 .char4 { color: #98FB98; }
        .nanach-signature .s5 .char5 { color: #AFEEEE; }

        @keyframes fadeIn依次 {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            /* .top-bar will be hidden by fullscreen-active .top-bar rule in fullscreen */
             .top-bar:not(body.fullscreen-active .top-bar) { /* Apply only when not in fullscreen on small screens */
                flex-direction: column;
                align-items: center;
            }
            .controls-container {
                margin-top:10px;
                justify-content: center;
            }
            .topic-display { font-size: calc(1.8em + 30px); }
            .letter-display { font-size: calc(1.5em + 10px); }
            .text-display { font-size: calc(1.3em + 10px); }
            body { padding: 80px 5% 60px 5%; }
            .nanach-signature { font-size: 20px; bottom: 10px; right: 10px; }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="controls-container">
            <button id="prev-btn" class="control-element top-text">הקודם</button>
            <button id="next-btn" class="control-element top-text">הבא</button>
            <button id="random-toggle" class="control-element top-text">סדר: רגיל</button>
            <div class="control-element">
                <label for="timing-select">זמן: </label>
                <select id="timing-select" onchange="updateInterval()">
                    <option value="3000">3 שניות</option>
                    <option value="5000">5 שניות</option>
                    <option value="7000" selected>7 שניות</option>
                    <option value="10000">10 שניות</option>
                    <option value="15000">15 שניות</option>
                    <option value="20000">20 שניות</option>
                    <option value="30000">30 שניות</option>
                    <option value="300000">5 דקות</option>
                    <option value="900000">15 דקות</option>
                    <option value="1800000">30 דקות</option>
                    <option value="3600000">1 שעה</option>
                    <option value="21600000">6 שעות</option>
                    <option value="43200000">12 שעות</option>
                    <option value="86400000">24 שעות</option>
                </select>
            </div>
             <div class="control-element">
                <label for="topic-select">נושא: </label>
                <select id="topic-select" onchange="handleTopicChange()">
                    <option value="all">כל הנושאים</option>
                </select>
            </div>
        </div>
        <button class="fullscreen-btn top-text" onclick="toggleFullScreen()">מסך מלא</button>
    </div>

    <div class="content-display">
        <div id="current-topic" class="topic-display">טוען...</div>
        <div id="current-letter" class="letter-display"></div>
        <div id="current-text" class="text-display"></div>
    </div>

    <div class="nanach-signature">
        <span class="s1">נ</span>
        <span class="s2">נח</span>
        <span class="s3">נחמ</span>
        <span class="s4">נחמן</span>
        <span class="s5">
            <span class="char1">מ</span><span class="char2">א</span><span class="char3">ו</span><span class="char4">מ</span><span class="char5">ן</span>
        </span>
    </div>

    <script>
        const entries = [
            // אמת - חלק ראשון
            { topic: "אמת", letter: "א", text: "מִי שֶׁרוֹצֶה לְדַבֵּק אֶת עַצְמוֹ בְּהַשֵּׁם יִתְבָּרַךְ, עַד שֶׁיֵּלֵךְ בְּמַחֲשַׁבְתּוֹ מֵהֵיכָל אֶל הֵיכָל וְיִרְאֶה אֶת הַהֵיכָלוֹת בְּעֵינֵי הַשֵּׂכֶל, יִשְׁמֹר אֶת עַצְמוֹ מִלּוֹמַר שֶׁקֶר אֲפִלּוּ בְּטָעוּת." },
            { topic: "אמת", letter: "ב", text: "מֻתָּר לְשַׁנּוֹת בִּדְבַר הַשָּׁלוֹם." },
            { topic: "אמת", letter: "ג", text: "כַּת שַׁקָּרִים אֵינָם מְקַבְּלִים פְּנֵי הַשְּׁכִינָה." },
            { topic: "אמת", letter: "ד", text: "שָׁרֵי לְהוּ לְצַדִּיקַיָּא לִסְגוּאֵי בְּרַמָּאוּתָא עִם רַמָּאֵי." },
            { topic: "אמת", letter: "ה", text: "כָּל הַמּוֹסִיף גּוֹרֵעַ." },
            { topic: "אמת", letter: "ו", text: "עַל-יְדֵי שֶׁקֶר בָּאִים הִרְהוּרֵי עֲבוֹדָה-זָרָה." },
            { topic: "אמת", letter: "ז", text: "עַל-יְדֵי אֱמֶת לֹא יָמוּת קֹדֶם זְמַנּוֹ הַקָּצוּב." },
            { topic: "אמת", letter: "ח", text: "מֵרוּחַ פִּיו שֶׁל הַשַּׁקְּרָן נַעֲשָׂה הַיֵּצֶר הָרָע, וּכְּשֶׁיָּבוֹא מָשִׁיחַ אָז לֹא יִהְיֶה שֶּׁקֶר, וּבִשְׁבִיל זֶה לֹא יִהְיֶה יֵצֶר הָרָע בָּעוֹלָם." },
            { topic: "אמת", letter: "ט", text: "מִי שֶׁהוּא אִישׁ אֱמֶת, אֲזַי הוּא מַכִּיר בְּאַחֵר, אִם אַחֵר דּוֹבֵר שֶׁקֶר אִם לָאו." },
            { topic: "אמת", letter: "י", text: "הַסִּימָן שֶׁל הַשֶּׁקֶר - כְּשֶׁלֹּא יַסְכִּימוּ עָלָיו רַבִּים, וְהוּא מִשְּׁלשָׁה שֶׁהַקָּדוֹשׁ-בָּרוּךְ-הוּא שׂוֹנְאָן." },
            { topic: "אמת", letter: "יא", text: "עָשִׁיר מְכַחֵשׁ - אֵין הַדַּעַת סוֹבְלוֹ וְהוּא נִבְזֶה בְּעֵינֵי עַצְמוֹ." },
            { topic: "אמת", letter: "יב", text: "תִּקּוּן לַפֶּה - שֶׁיִּתֵּן צְדָקָה." },
            { topic: "אמת", letter: "יג", text: "עַל-יְדֵי אֱמֶת הָעוֹלָם נִשְׁמָר מִכָּל הֶזֵּקוֹת." },
            { topic: "אמת", letter: "יד", text: "עַל-יְדֵי חֲנֻפָּה בָּא לְשֶׁקֶר." },
            { topic: "אמת", letter: "טו", text: "מִי שֶׁנּוֹתֵן צְדָקָה שְׂכָרוֹ שֶׁיִּזְכֶּה לֶאֱמֶת." },
            { topic: "אמת", letter: "טז", text: "הַשַּׁקְרָן שׂוֹנֵא עֲנִיווּת." },
            { topic: "אמת", letter: "יז", text: "אָדָם נִכָּר עַל-יְדֵי מְשָׁרְתָיו, אִם הוּא אוֹהֵב שֶׁקֶר כִּי זֶה בָּזֶה תָּלוּי. לִפְעָמִים מְשָׁרְתָיו נוֹפְלִים לַעֲבֵרוֹת עַל-יְדֵי שֶׁהוּא שַׁקְרָן, וְלִפְעָמִים הוּא נוֹפֵל לְשֶׁקֶר עַל-יְדֵי מְשָׁרְתָיו, שֶׁאֵינָם הֲגוּנִים." },
            { topic: "אמת", letter: "יח", text: "כְּשֶׁאֵין אֱמֶת אֵין חֶסֶד. גַּם אֵינוֹ יָכוֹל לַעֲשׂוֹת ]חֶסֶד[ עִם בְּנֵי-אָדָם." },
            { topic: "אמת", letter: "יט", text: "הַשֶּׁקֶר מְעַכֵּב אֶת הַיְשׁוּעָה, כִּי הַשֶּׁקֶר מְגַלֶּה עֲווֹנוֹתָיו, כְּדֵי שֶׁלֹּא יוֹשִׁיעוּ לוֹ." },
            { topic: "אמת", letter: "כ", text: "הָאֱמֶת הִוא פּוֹדָה מִכָּל הַצָּרוֹת." },
            { topic: "אמת", letter: "כא", text: "טוֹב לָאָדָם שֶׁיָּמוּת, מִשֶּׁיִּחְיֶה וְיִהְיֶה שַׁקְרָן בְּעֵינֵי בְּנֵי-אָדָם." },
            { topic: "אמת", letter: "כב", text: "כְּשֶׁיֵּשׁ אֱמֶת יֵשׁ שָׁלוֹם." },
            { topic: "אמת", letter: "כג", text: "מִי שֶׁרָחוֹק מֵאֱמֶת, רָחוֹק מִצְּדָקָה." },
            { topic: "אמת", letter: "כד", text: "עַל-יְדֵי אֱמֶת נִשְׁמָר אוֹת בְּרִית." },
            { topic: "אמת", letter: "כה", text: "עַל-יְדֵי אֱמֶת יִזְכֶּה לְשֵׁם עוֹלָם." },
            { topic: "אמת", letter: "כו", text: "אִישׁ וְאִשָּׁה שֶׁרְגִילִין לוֹמַר שֶׁקֶר, הַבָּנִים שֶׁלָּהֶם יִהְיוּ מִתְנַגְּדִים גַּם יִהְיוּ פּוֹגְמִים בַּבְּרִית." },
            { topic: "אמת", letter: "כז", text: "הַשֶּׁקֶר בָּא עַל-יְדֵי שֶׁמְּקַבֵּל עַל עַצְמוֹ פַּחַד מִבְּנֵי-אָדָם." },
            { topic: "אמת", letter: "כח", text: "עַל-יְדֵי הַשֶּׁקֶר שׁוֹכְחִין אֶת הַקָּדוֹשׁ-בָּרוּךְ- הוּא." },
            { topic: "אמת", letter: "כט", text: "מִי שֶׁאֵין לּוֹ בִּטָּחוֹן, הוּא דּוֹבֵר שְׁקָרִים, וְעַל-יְדֵי שְׁקָרִים אֵין יָכוֹל לִבְטֹחַ בָּאֱמֶת." },
            { topic: "אמת", letter: "ל", text: "לְפִי הַרִחוּק מֵאֱמֶת כֵּן מַחֲזִיק אֶת הַסּוּר- מֵרָע לְשׁוֹטֶה." },
            { topic: "אמת", letter: "לא", text: "מִי שֶׁרוֹצֶה לָסוּר מֵרָע, וְרוֹאֶה שֶׁאֵין אֱמֶת בָּעוֹלָם, עוֹשֶׂה עַצְמוֹ כְּשֶׁוֹטֶה." },
            { topic: "אמת", letter: "לב", text: "מִי שֶׁאֵינוֹ אוֹמֵר שֶׁקֶר, הַקָּדוֹשׁ-בָּרוּךְ-הוּא מוֹשִׁיעַ לוֹ בְּעֵת צָרָתוֹ גַּם בָּנִים יִהְיוּ לוֹ." },
            { topic: "אמת", letter: "לג", text: "עַל-יְדֵי דִּבּוּר שָׁוְא בָּא מַכּוֹת בָּנִים." },
            { topic: "אמת", letter: "לד", text: "מִי שֶׁמְּקֻשָּׁר לַשָּׁוְא, בָּא לְשִׁכְחָה." },
            { topic: "אמת", letter: "לה", text: "עַל-יְדֵי שֶׁקֶר בָּא לְנִאוּף, וּמַחֲזִיק יְדֵי מְרֵעִים, שֶׁלֹּא יַחְזְרוּ בִּתְשׁוּבָה." },
            { topic: "אמת", letter: "לו", text: "עַל-יְדֵי שְׁקָרִים אֵין לוֹ רְפוּאָה אֲפִלּוּ בְּהַרְבֵּה רְפוּאוֹת." },
            { topic: "אמת", letter: "לז", text: "מִי שֶׁדּוֹבֵר כְּזָבִים נוֹפֵל בַּחֶרֶב. גַּם נַעֲשֶׂה שׁוֹטֶה." },
            { topic: "אמת", letter: "לח", text: "עַל-יְדֵי יִרְאָה בָּא לֶאֱמֶת." },
            { topic: "אמת", letter: "לט", text: "מִי שֶׁשּׁוֹמֵר אֶת עַצְמוֹ מִשֶּׁקֶר, הוּא מְנַצֵּחַ תָּמִיד." },
            { topic: "אמת", letter: "מ", text: "מֻתָּר לְשַׁנּוֹת, כְּדֵי לְהַצִּיל אֶת עַצְמוֹ." },
            { topic: "אמת", letter: "מא", text: "מִי שֶׁאוֹהֵב כְּזָבִים, הוּא מְבַזֶּה אֶת הַצַּדִּיק גַּם הוּא בְּעַצְמוֹ נִתְבַּזֶּה." },
            { topic: "אמת", letter: "מב", text: "מִי שֶׁדּוֹבֵר כְּזָבִים, הוּא אוֹבֵד." },
            { topic: "אמת", letter: "מג", text: "עַל-יְדֵי אֱמֶת נִצּוֹל מִלָּשׁוֹן-הָרָע גַּם תְּפִלָּתוֹ נִתְקַבֵּל. גַּם כְּשֶׁדָּנִים אוֹתוֹ לְמַעְלָה, דָּנִים אוֹתוֹ לְפִי זְכֻיּוֹת שֶׁלּוֹ." },
            { topic: "אמת", letter: "מד", text: "עַל-יְדֵי חֲלוֹמוֹת יֵדַע אָדָם אִם לִבּוֹ אֱמֶת עִם אֱלֹקָיו." },
            { topic: "אמת", letter: "מה", text: "מִי שֶׁמְּקַיֵּם דִּבּוּרוֹ, יָכוֹל לַעֲשׂוֹת פְּעֻלּוֹת." },
            { topic: "אמת", letter: "מו", text: "מִי שֶׁאֵין לוֹ גַּאֲוָה נִצּוֹל מִשָּׁקֶר." },
            { topic: "אמת", letter: "מז", text: "מִי שֶׁשּׁוֹמֵר אֶת עַצְמוֹ מִשְּׂחוֹק שֶׁל הִתּוּל, בְּיָדוּעַ שֶׁהוּא אִישׁ אֱמֶת." },
            { topic: "אמת", letter: "מח", text: "מִי שֶׁהָיָה שַׁקְרָן מִגִּלְגּוּל הֶעָבָר, עַל-יְדֵי-זֶה כְּשֶׁנִּתְגַּלְגֵּל, נַעֲשָׂה אִטֵּר-יָד." },
            { topic: "אמת", letter: "מט", text: "מִי שֶׁשּׁוֹמֵר אֶת עַצְמוֹ וְדוֹבֵר תָּמִיד אֱמֶת, כְּאִלּוּ עָשָׂה שָׁמַיִם וָאָרֶץ וְאֶת הַיָּם וְאֶת כָּל אֲשֶׁר בָּם." },
            { topic: "אמת", letter: "נ", text: "הַשֶּׁקֶר אֵינוֹ אֶלָּא בְּפִיו, אֲבָל לֹא בִּכְתָב." },
            { topic: "אמת", letter: "נא", text: "דִּבְּרוּ תּוֹרָה וּנְבִיאִים וַחֲכָמִים בִּלְשׁוֹן הֲבַאי." },
            // אמת - חלק שני
            { topic: "אמת (חלק שני)", letter: "א", text: "עַל-יְדֵי שֶׁקֶר דְּבָרָיו אֵינָם נִשְׁמָעִים. גַּם עַל-יְדֵי שֶׁקֶר מְאַלְמֵן, חַס וְשָׁלוֹם, כַּמָּה נָשִׁים." },
            { topic: "אמת (חלק שני)", letter: "ב", text: "עַל-יְדֵי אֱמֶת נִתְגַּלֶּה יִחוּדוֹ בָּעוֹלָם." },
            { topic: "אמת (חלק שני)", letter: "ג", text: "כְּשֶׁאַתָּה רוֹאֶה שַׁקְרָן, תֵּדַע, שֶׁגַּם הַמַּנְהִיג שֶׁל הָאִישׁ הַזֶּה שַׁקְרָן." },
            { topic: "אמת (חלק שני)", letter: "ד", text: "עַל-יְדֵי שֶׁקֶר בָּא לִידֵי גִּלּוּי-עֲרָיוֹת וּשְׁפִיכוּת-דָּמִים, וְגַם מַכְּשֶׁיל אֶת הַכְּשֶׁרִים בְּגִלּוּי-עֲרָיוֹת וּשְׁפִיכוּת-דָּמִים, וּמַרְאֶה הֶתֵּר מִן הַתּוֹרָה." },
            { topic: "אמת (חלק שני)", letter: "ה", text: "מִי שֶׁאֵינוֹ מְשַׁנֶּה בְּדִבּוּרוֹ, הוּא יָכוֹל לְהַשְׁפִּיל הַגְּבוֹהִים וּלְהַגְבִּיהַּ הַשְּׁפָלִים." },
            { topic: "אמת (חלק שני)", letter: "ו", text: "מִי שֶׁאֵינוֹ מְדַבֵּר אֶחָד בַּפֶּה וְאֶחָד בַּלֵּב, אֵינוֹ מִתְיָרֵא מִטְבִיעַת מַיִם." },
            { topic: "אמת (חלק שני)", letter: "ז", text: "הָאֱמֶת מֵבִיא שׂבַע." },
            { topic: "אמת (חלק שני)", letter: "ח", text: "הַשִּׁלְשׁוּל וְהָעֲצִירוּת בָּא עַל-יְדֵי שֶׁקֶר." },
            { topic: "אמת (חלק שני)", letter: "ט", text: "עַל-יְדֵי אֱמֶת בָּא הַקֵּץ." },
            // הכנסת אורחים - חלק ראשון
            { topic: "הכנסת אורחים", letter: "א", text: "מִי שֶׁאֵין מַכְנִיס אוֹרְחִים, בָּזֶה מַחֲזִיק יְדֵי מְרֵעִים, שֶׁלֹּא יַחְזְרוּ בִּתְשׁוּבָה." },
            { topic: "הכנסת אורחים", letter: "ב", text: "עִיר שֶׁאֵין בָּהּ הַכְנָסַת אוֹרְחִים בָּאִים לִידֵי גִּלּוּי-עֲרָיוֹת, וְעַל-יְדֵי גִּלּוּי-עֲרָיוֹת בָּא עֲלֵיהֶם הֲרִיגָה." },
            { topic: "הכנסת אורחים", letter: "ג", text: "הַכְנָסַת אוֹרְחִים מְזַכָּה אֶת הָאִשָּׁה לְבָנִים." },
            { topic: "הכנסת אורחים", letter: "ד", text: "הַכְנָסַת אוֹרְחִים כְּהַכְנָסַת שַׁבָּת." },
            { topic: "הכנסת אורחים", letter: "ה", text: "הַמְאָרֵחַ תַּלְמִיד-חָכָם בְּתוֹךְ בֵּיתוֹ - מַעֲלֶה עָלָיו הַכָּתוּב כְּאִלּוּ הִקְרִיב תְּמִידִין." },
            { topic: "הכנסת אורחים", letter: "ו", text: "גְּדוֹלָה הַכְנָסַת אוֹרְחִים מֵהַשְׁכָּמַת בֵּית- הַמִּדְרָשׁ וְהַקְבָּלַת פְּנֵי שְׁכִינָה." },
            { topic: "הכנסת אורחים", letter: "ז", text: "כֵּיוָן דְּלָא שְׁכִיחֵי רַבָּנָן גַּבַּיְהוּ כַּכּוּתִיִּים דָּמֵי." },
            // הכנסת אורחים - חלק שני
            { topic: "הכנסת אורחים (חלק שני)", letter: "א", text: "עַל-יְדֵי הַכְנָסַת-אוֹרְחִים אֵימָתוֹ מֻטֶּלֶת עַל הַבְּרִיּוֹת." },
            { topic: "הכנסת אורחים (חלק שני)", letter: "ב", text: "סְגֻלָּה לְהַחֲזִיר לְאִשָּׁה וִסְתָּהּ עַל-יְדֵי הַכְנָסַת-אוֹרְחִים." },
            { topic: "הכנסת אורחים (חלק שני)", letter: "ג", text: "עַל-יְדֵי קְדֻשַּׁת הַשֵּׁם יִתְבָּרַךְ הַהִתְנַשְּׂאוּת שֶׁל רָאשֵׁי-הַדּוֹר בְּתֹקֶף וָעֹז, וְעַל-יְדֵי-זֶה נֶחְשָׁב בְּעֵינֵי כֹּל הַמִּצְוָה שֶׁל הַכְנָסַת- אוֹרְחִים, וְעַל-יְדֵי-זֶה הַלּוֹמְדִים זוֹכִים שֶׁהֲלָכָה כְּמוֹתָם." }
        ];

        let current = 0;
        let isRandom = false;
        let duration = 7000;
        let intervalId;
        let currentFilteredEntries = [...entries];
        let currentSelectedTopic = "all";

        const topicElement = document.getElementById('current-topic');
        const letterElement = document.getElementById('current-letter');
        const textElement = document.getElementById('current-text');
        const randomToggleButton = document.getElementById('random-toggle');
        const topicSelectElement = document.getElementById('topic-select');
        const bodyElement = document.body; 

        function populateTopicSelect() {
            const topics = new Set(entries.map(entry => entry.topic));
            while (topicSelectElement.options.length > 1) {
                topicSelectElement.remove(1);
            }
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicSelectElement.appendChild(option);
            });
        }

        function updateDisplay() {
            if (currentFilteredEntries.length === 0) {
                topicElement.textContent = (currentSelectedTopic === "all" && entries.length > 0) ? entries[0].topic : "אין משפטים לנושא הנבחר";
                letterElement.textContent = (currentSelectedTopic === "all" && entries.length > 0) ? "סעיף " + entries[0].letter : "";
                textElement.textContent = (currentSelectedTopic === "all" && entries.length > 0) ? entries[0].text : "";
                if (currentSelectedTopic === "all" && entries.length > 0) current = 0; // Reset current for "all" if needed
                return;
            }
            if (current >= currentFilteredEntries.length) { current = 0; }
            
            const entry = currentFilteredEntries[current];
            if (entry) {
                topicElement.style.opacity = 0;
                letterElement.style.opacity = 0;
                textElement.style.opacity = 0;
                setTimeout(() => {
                    topicElement.textContent = entry.topic;
                    letterElement.textContent = "סעיף " + entry.letter;
                    textElement.textContent = entry.text;
                    topicElement.style.opacity = 1;
                    letterElement.style.opacity = 1;
                    textElement.style.opacity = 1;
                }, 300);
            }
        }
        
        function handleTopicChange() {
            currentSelectedTopic = topicSelectElement.value;
            if (currentSelectedTopic === "all") {
                currentFilteredEntries = [...entries];
            } else {
                currentFilteredEntries = entries.filter(entry => entry.topic === currentSelectedTopic);
            }
            current = 0; 
            updateDisplay();
            resetInterval();
        }

        function nextSlide() {
            if (currentFilteredEntries.length === 0) return;
            if (isRandom) {
                let next = current;
                if (currentFilteredEntries.length > 1) {
                    do {
                        next = Math.floor(Math.random() * currentFilteredEntries.length);
                    } while (next === current);
                }
                current = next;
            } else {
                current = (current + 1) % currentFilteredEntries.length;
            }
            updateDisplay();
        }

        function prevSlide() {
            if (currentFilteredEntries.length === 0) return;
            current = (current - 1 + currentFilteredEntries.length) % currentFilteredEntries.length;
            updateDisplay();
        }

        function toggleRandom() {
            isRandom = !isRandom;
            randomToggleButton.textContent = isRandom ? "סדר: אקראי" : "סדר: רגיל";
        }

        function toggleFullScreen() {
            const elem = document.documentElement;
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => console.log("Fullscreen error:", err.message));
                } else if (elem.mozRequestFullScreen) { 
                    elem.mozRequestFullScreen();
                } else if (elem.webkitRequestFullscreen) { 
                    elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                } else if (elem.msRequestFullscreen) { 
                    elem.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }
        
        function onFullscreenChange() {
            const isFullscreen = document.fullscreenElement || document.webkitIsFullScreen || document.mozFullScreenElement || document.msFullscreenElement;
            if (isFullscreen) {
                bodyElement.classList.add('fullscreen-active');
            } else {
                bodyElement.classList.remove('fullscreen-active');
            }
        }

        function updateInterval() {
            const select = document.getElementById("timing-select");
            duration = parseInt(select.value);
            resetInterval();
        }

        function resetInterval() {
            clearInterval(intervalId);
            if (currentFilteredEntries.length > 0) {
                 intervalId = setInterval(nextSlide, duration);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateTopicSelect(); 
            
            // Initialize with "all" topics selected if no specific topic is chosen or data is empty for it
            if (currentSelectedTopic === "all" || currentFilteredEntries.length === 0) {
                 currentFilteredEntries = [...entries]; // Ensure it's populated for the first display
            }
            
            const initialDurationSelect = document.getElementById("timing-select");
            duration = parseInt(initialDurationSelect.value);

            if (entries.length > 0) {
                 updateDisplay(); 
                 intervalId = setInterval(nextSlide, duration);
            } else {
                topicElement.textContent = "נא לטעון משפטים בספר המידות";
            }

            document.getElementById('prev-btn').addEventListener('click', () => {
                prevSlide();
                resetInterval();
            });
            document.getElementById('next-btn').addEventListener('click', () => {
                nextSlide();
                resetInterval();
            });
            document.getElementById('random-toggle').addEventListener('click', toggleRandom);

            document.addEventListener('fullscreenchange', onFullscreenChange);
            document.addEventListener('webkitfullscreenchange', onFullscreenChange);
            document.addEventListener('mozfullscreenchange', onFullscreenChange);
            document.addEventListener('MSFullscreenChange', onFullscreenChange);
        });
    </script>
</body>
</html>
