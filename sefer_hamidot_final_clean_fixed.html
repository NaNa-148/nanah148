<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ספר המידות - רבי נחמן</title>
    <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@400;700&family=David+Libre:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 20px 5% 60px 5%; /* Adjusted padding for top title and bottom signature */
            min-height: 100vh;
            background: linear-gradient(to bottom right, #0b1e2f, #1a2e4f);
            color: white;
            font-family: 'Frank Ruhl Libre', 'David Libre', 'Arial', 'Narkis Block', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .page-title {
            font-size: 1.5em; /* Smaller title for the book name */
            font-weight: normal;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
            position: fixed;
            top: 20px; /* Position at the top */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 5px;
            z-index: 1000; /* Ensure it's above content but below fullscreen controls potentially */
        }

        .top-bar {
            position: fixed;
            top: 70px; /* Adjusted to be below the new page title */
            width: 90%; /* Centered controls */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center; /* Center the controls container */
            align-items: center;
            padding: 0 15px;
            box-sizing: border-box;
            z-index: 999;
            flex-wrap: wrap;
        }
        .controls-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center; /* Ensure controls inside are centered */
        }
        .control-element {
            font-size: 1em; /*统一控制元素字体大小 (16px default) */
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px; /* Increased padding for better touch */
            border-radius: 5px;
            color: white;
            border: none;
            cursor: pointer;
            font-family: 'Arial', sans-serif; /* Simpler font for controls */
        }
        .control-element select, .control-element label {
             background: transparent;
             color: white;
             border: none;
             padding: 2px;
             font-family: 'Arial', sans-serif;
        }
        .control-element option {
            background: #1a2e4f;
            color: white;
        }

        .content-display {
            max-width: 900px; /* Increased max-width for larger fonts */
            width: 90%;
            margin-top: 120px; /* Extra space for fixed top bar and title */
            margin-bottom: 80px; /* Extra space for fixed signature */
        }
        .topic-display, .letter-display, .text-display {
            margin-bottom: 20px; /* Increased margin */
            transition: opacity 0.5s ease-in-out;
            color: white; /* Unified color */
        }
        .topic-display {
            font-size: 3.3em; /* Significantly larger ~1.5x */
            font-weight: bold;
        }
        .letter-display {
            font-size: 2.7em; /* Significantly larger ~1.5x */
        }
        .text-display {
            font-size: 2.4em; /* Significantly larger ~1.5x */
            line-height: 1.9; /* Adjusted line height */
            min-height: 150px;
        }
        .nanach-signature {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 1.8em; /* Slightly larger signature */
            font-weight: bold;
            color: rgba(255, 255, 255, 0.75);
            display: flex;
            white-space: nowrap;
            font-family: 'Frank Ruhl Libre', 'David Libre', serif;
            z-index: 1000; /* Ensure it's above other content */
        }

        .nanach-signature span {
            opacity: 0;
            animation: fadeIn依次 1s forwards;
            margin-left: 2px; /* Small space between animated parts */
        }
        .nanach-signature .letter1 { animation-delay: 0.5s; }
        .nanach-signature .letter2 { animation-delay: 1.0s; }
        .nanach-signature .letter3 { animation-delay: 1.5s; }
        .nanach-signature .letter4 { animation-delay: 2.0s; }
        .nanach-signature .letter5 { animation-delay: 2.5s; margin-left: 15px; } /* Space before מאומן */
        .nanach-signature .letter6 { animation-delay: 3.0s; }
        .nanach-signature .letter7 { animation-delay: 3.5s; }
        .nanach-signature .letter8 { animation-delay: 4.0s; }
        .nanach-signature .letter9 { animation-delay: 4.5s; }


        @keyframes fadeIn依次 {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Fullscreen adjustments */
        body:fullscreen .top-bar,
        body:fullscreen .page-title {
            display: none;
        }
        /* For Webkit browsers */
        body:-webkit-full-screen .top-bar,
        body:-webkit-full-screen .page-title {
            display: none;
        }
        /* For MS browsers */
        body:-ms-fullscreen .top-bar,
        body:-ms-fullscreen .page-title {
            display: none;
        }


        @media (max-width: 768px) { /* Adjustments for smaller screens */
            body { padding-top: 130px; /* Ensure space for fixed elements */ }
            .page-title { font-size: 1.2em; top:10px; }
            .top-bar { top: 55px; flex-direction: column; }
            .controls-container { margin-top:5px; justify-content: center; }
            .topic-display { font-size: 2.5em; }
            .letter-display { font-size: 2em; }
            .text-display { font-size: 1.8em; }
            .nanach-signature { font-size: 1.5em; }
            .content-display { margin-top: 80px; } /* Adjust margin if top-bar wraps */

        }
         @media (max-width: 480px) { /* Further adjustments for very small screens */
            .control-element { font-size: 0.9em; padding: 8px 10px;}
            .topic-display { font-size: 2em; }
            .letter-display { font-size: 1.6em; }
            .text-display { font-size: 1.5em; }
            .nanach-signature { font-size: 1.2em; bottom:10px; right:10px; }
        }


    </style>
</head>
<body>
    <div class="page-title">ספר המידות - רבי נחמן</div>

    <div class="top-bar">
        <div class="controls-container">
            <button id="prev-btn" class="control-element">הקודם</button>
            <button id="next-btn" class="control-element">הבא</button>
            <button id="random-toggle" class="control-element">סדר: רגיל</button>
            <div class="control-element">
                <label for="timing-select">זמן (שניות): </label>
                <select id="timing-select" onchange="updateInterval()">
                    <option value="3000">3</option>
                    <option value="5000">5</option>
                    <option value="7000" selected>7</option>
                    <option value="10000">10</option>
                    <option value="15000">15</option>
                    <option value="20000">20</option>
                    <option value="30000">30</option>
                </select>
            </div>
             <div class="control-element">
                <label for="topic-select">נושא: </label>
                <select id="topic-select" onchange="handleTopicChange()">
                    <option value="all">כל הנושאים</option>
                </select>
            </div>
        </div>
        <button class="fullscreen-btn control-element" onclick="toggleFullScreen()">מסך מלא</button>
    </div>

    <div class="content-display">
        <div id="current-topic" class="topic-display">טוען...</div>
        <div id="current-letter" class="letter-display"></div>
        <div id="current-text" class="text-display"></div>
    </div>

    <div class="nanach-signature">
        <span class="letter1">נ</span>
        <span class="letter2">&nbsp;נח</span>
        <span class="letter3">&nbsp;נחמ</span>
        <span class="letter4">&nbsp;נחמן</span>
        <span class="letter5">מ</span>
        <span class="letter6">א</span>
        <span class="letter7">ו</span>
        <span class="letter8">מ</span>
        <span class="letter9">ן</span>
    </div>

    <script>
        const entries = [
            { topic: "אמת", letter: "א", text: "הַבּוֹרֵחַ מִן הַכָּבוֹד, הַכָּבוֹד רוֹדֵף אַחֲרָיו. וְהָרוֹדֵף אַחַר הַכָּבוֹד, הַכָּבוֹד בּוֹרֵחַ מִמֶּנּוּ. וְכָל שֶׁכֵּן מִי שֶׁמַּשִּׂיג גְּבוּל חֲבֵרוֹ לְהִתְכַּבֵּד בִּכְבוֹדוֹ, שֶׁאָז בְּוַדַּאי הַכָּבוֹד בּוֹרֵחַ מִמֶּנּוּ." },
            { topic: "אמת", letter: "ב", text: "עַל יְדֵי אֱמֶת דְּקִדּוּשָׁה בָּא עַל יְדֵי זֶה שֶׁמֶץ מִנְהוּ דְּקִדּוּשָׁה." },
            { topic: "אמת", letter: "ג", text: "עַל יְדֵי אֱמֶת נַעֲשֶׂה שָׁלוֹם." },
            { topic: "אמת", letter: "ד", text: "כְּשֶׁאָדָם הוֹלֵךְ בְּדֶרֶךְ הָאֱמֶת וְהַיָּשָׁר, אֲזַי הַקָּדוֹשׁ-בָּרוּךְ-הוּא מְקַיֵּם מַחְשְׁבוֹתָיו." },
            { topic: "אמת", letter: "ה", text: "עַל יְדֵי אֱמֶת דִּבְרֵי חֲכָמִים נִשְׁמָעִין." },
            { topic: "אמת", letter: "ו", text: "מִי שֶׁהוֹלֵךְ עִם אֱמֶת, אֵין צָרִיךְ לְהַחֲנִיף לִבְנֵי אָדָם." },
            { topic: "אמת", letter: "ז", text: "אֱמֶת הוּא רְפוּאָה לְכָל הַמַּכּוֹת." },
            { topic: "אמת", letter: "ח", text: "עַל יְדֵי אֱמֶת בָּאִים לְשִׂמְחָה." },
            { topic: "אמת", letter: "ט", text: "עַל יְדֵי אֱמֶת נִצּוֹלִין מִן הַחֲנֻפָּה." },
            { topic: "אמת", letter: "י", text: "עַל יְדֵי אֱמֶת נִתְקַבְּלִין הַתְּפִלּוֹת." }
        ];

        // המשתנים הגלובליים
        let current = 0;
        let isRandom = false;
        let duration = 7000;
        let intervalId;
        let currentFilteredEntries = [...entries];
        let currentSelectedTopic = "all";

        const topicElement = document.getElementById('current-topic');
        const letterElement = document.getElementById('current-letter');
        const textElement = document.getElementById('current-text');
        const randomToggleButton = document.getElementById('random-toggle');
        const topicSelectElement = document.getElementById('topic-select');
        const bodyElement = document.body; // Get body element for fullscreen class

        // פונקציה לאכלוס תפריט הנושאים
        function populateTopicSelect() {
            const topics = new Set(entries.map(entry => entry.topic));
            // Clear existing options except for "all"
            while (topicSelectElement.options.length > 1) {
                topicSelectElement.remove(1);
            }
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicSelectElement.appendChild(option);
            });
        }

        // פונקציה לעדכון התצוגה
        function updateDisplay() {
            if (currentFilteredEntries.length === 0) {
                topicElement.textContent = "אין משפטים לנושא הנבחר";
                letterElement.textContent = "";
                textElement.textContent = "";
                return;
            }

            if (current >= currentFilteredEntries.length) {
                current = 0;
            }
            
            const entry = currentFilteredEntries[current];
            if (entry) {
                topicElement.style.opacity = 0;
                letterElement.style.opacity = 0;
                textElement.style.opacity = 0;

                setTimeout(() => {
                    topicElement.textContent = entry.topic;
                    letterElement.textContent = "סעיף " + entry.letter;
                    textElement.textContent = entry.text;
                    topicElement.style.opacity = 1;
                    letterElement.style.opacity = 1;
                    textElement.style.opacity = 1;
                }, 300);
            }
        }
        
        function handleTopicChange() {
            currentSelectedTopic = topicSelectElement.value;
            if (currentSelectedTopic === "all") {
                currentFilteredEntries = [...entries];
            } else {
                currentFilteredEntries = entries.filter(entry => entry.topic === currentSelectedTopic);
            }
            current = 0;
            updateDisplay();
            resetInterval();
        }

        function nextSlide() {
            if (currentFilteredEntries.length === 0) return;
            if (isRandom) {
                let next = current;
                if (currentFilteredEntries.length > 1) {
                    do {
                        next = Math.floor(Math.random() * currentFilteredEntries.length);
                    } while (next === current);
                }
                current = next;
            } else {
                current = (current + 1) % currentFilteredEntries.length;
            }
            updateDisplay();
        }

        function prevSlide() {
            if (currentFilteredEntries.length === 0) return;
            current = (current - 1 + currentFilteredEntries.length) % currentFilteredEntries.length;
            updateDisplay();
        }

        function toggleRandom() {
            isRandom = !isRandom;
            randomToggleButton.textContent = isRandom ? "סדר: אקראי" : "סדר: רגיל";
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                if (bodyElement.requestFullscreen) {
                    bodyElement.requestFullscreen().catch(err => console.log(err));
                } else if (bodyElement.webkitRequestFullscreen) { /* Safari */
                    bodyElement.webkitRequestFullscreen().catch(err => console.log(err));
                } else if (bodyElement.msRequestFullscreen) { /* IE11 */
                    bodyElement.msRequestFullscreen().catch(err => console.log(err));
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE11 */
                    document.msExitFullscreen();
                }
            }
        }
        
        function updateInterval() {
            const select = document.getElementById("timing-select");
            duration = parseInt(select.value);
            resetInterval();
        }

        function resetInterval() {
            clearInterval(intervalId);
            if (currentFilteredEntries.length > 0) {
                 intervalId = setInterval(nextSlide, duration);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateTopicSelect();
            const initialDurationSelect = document.getElementById("timing-select");
            duration = parseInt(initialDurationSelect.value);

            if (entries.length > 0) {
                 handleTopicChange(); // To initialize currentFilteredEntries correctly
                 updateDisplay(); 
                 intervalId = setInterval(nextSlide, duration);
            } else {
                topicElement.textContent = "נא לטעון משפטים בספר המידות";
            }

            document.getElementById('prev-btn').addEventListener('click', () => {
                prevSlide();
                resetInterval();
            });
            document.getElementById('next-btn').addEventListener('click', () => {
                nextSlide();
                resetInterval();
            });
            document.getElementById('random-toggle').addEventListener('click', toggleRandom);
            
            // Event listener for fullscreen change to toggle body class for CSS styling (not strictly needed with direct element hiding)
            // However, the CSS :fullscreen pseudo-class is more robust.
        });

    </script>
</body>
</html>
