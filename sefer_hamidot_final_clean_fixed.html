<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ספר המידות</title>
    <style>
        body {
            margin: 0;
            padding: 60px 5%;
            min-height: 100vh;
            background: linear-gradient(to bottom right, #0b1e2f, #1a2e4f);
            color: white;
            font-family: 'Arial', 'Narkis Block', 'David Libre', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .top-bar {
            position: fixed;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            box-sizing: border-box;
            z-index: 999;
            flex-wrap: wrap;
        }

        body.fullscreen-active .top-bar {
            display: none !important;
        }

        .controls-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .top-text, .control-element {
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 5px;
            color: white;
            border: none;
            cursor: pointer;
        }
        .control-element select {
             background: transparent;
             color: white;
             border: none;
             padding: 2px;
        }
        .control-element option {
            background: #1a2e4f;
            color: white;
        }

        .content-display {
            max-width: 800px;
            width: 90%;
        }
        .topic-display, .letter-display, .text-display {
            margin-bottom: 15px;
            transition: opacity 0.5s ease-in-out;
        }
        .topic-display {
            font-size: calc(2.2em + 30px);
            font-weight: bold;
            color: white;
        }
        .letter-display {
            font-size: calc(1.8em + 10px);
            color: white;
        }
        .text-display {
            font-size: calc(1.6em + 10px);
            line-height: 1.8;
            min-height: 100px;
            color: white;
        }

        .nanach-signature {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            white-space: nowrap;
            font-family: 'David Libre', 'Narkis Block', serif;
            z-index: 1001;
        }

        .nanach-signature span {
            opacity: 0;
            animation: fadeIn依次 1s forwards;
        }

        .nanach-signature .s1 { color: white; animation-delay: 0.5s; }
        .nanach-signature .s2 { color: #FFD700; animation-delay: 1.0s; margin-right: 0.7em; }
        .nanach-signature .s3 { color: #FF7F50; animation-delay: 1.5s; margin-right: 0.7em; }
        .nanach-signature .s4 { color: #87CEEB; animation-delay: 2.0s; margin-right: 0.7em; }
        .nanach-signature .s5 {
            animation-delay: 2.5s; margin-right: 0.7em;
        }
        .nanach-signature .s5 .char1 { color: #FFDAB9; }
        .nanach-signature .s5 .char2 { color: #FFFF00; }
        .nanach-signature .s5 .char3 { color: #EE82EE; }
        .nanach-signature .s5 .char4 { color: #98FB98; }
        .nanach-signature .s5 .char5 { color: #AFEEEE; }

        @keyframes fadeIn依次 {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            .top-bar:not(body.fullscreen-active .top-bar) {
                flex-direction: column;
                align-items: center;
            }
            .controls-container {
                margin-top:10px;
                justify-content: center;
            }
            .topic-display { font-size: calc(1.8em + 30px); }
            .letter-display { font-size: calc(1.5em + 10px); }
            .text-display { font-size: calc(1.3em + 10px); }
            body { padding: 80px 5% 60px 5%; }
            .nanach-signature { font-size: 20px; bottom: 10px; right: 10px; }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="controls-container">
            <button id="prev-btn" class="control-element top-text">הקודם</button>
            <button id="next-btn" class="control-element top-text">הבא</button>
            <button id="random-toggle" class="control-element top-text">סדר: רגיל</button>
            <div class="control-element">
                <label for="timing-select">זמן: </label>
                <select id="timing-select" onchange="updateInterval()">
                    <option value="3000">3 שניות</option>
                    <option value="5000">5 שניות</option>
                    <option value="7000" selected>7 שניות</option>
                    <option value="10000">10 שניות</option>
                    <option value="15000">15 שניות</option>
                    <option value="20000">20 שניות</option>
                    <option value="30000">30 שניות</option>
                    <option value="300000">5 דקות</option>
                    <option value="900000">15 דקות</option>
                    <option value="1800000">30 דקות</option>
                    <option value="3600000">1 שעה</option>
                    <option value="21600000">6 שעות</option>
                    <option value="43200000">12 שעות</option>
                    <option value="86400000">24 שעות</option>
                </select>
            </div>
             <div class="control-element">
                <label for="topic-select">נושא: </label>
                <select id="topic-select" onchange="handleTopicChange()">
                    <option value="all">כל הנושאים</option>
                </select>
            </div>
        </div>
        <button class="fullscreen-btn top-text" onclick="toggleFullScreen()">מסך מלא</button>
    </div>

    <div class="content-display">
        <div id="current-topic" class="topic-display">טוען נתונים...</div>
        <div id="current-letter" class="letter-display"></div>
        <div id="current-text" class="text-display"></div>
    </div>

    <div class="nanach-signature">
        <span class="s1">נ</span>
        <span class="s2">נח</span>
        <span class="s3">נחמ</span>
        <span class="s4">נחמן</span>
        <span class="s5">
            <span class="char1">מ</span><span class="char2">א</span><span class="char3">ו</span><span class="char4">מ</span><span class="char5">ן</span>
        </span>
    </div>

    <script>
        let entries = [];
        let current = 0;
        let isRandom = false;
        let duration = 7000;
        let intervalId;
        let currentFilteredEntries = [];
        let currentSelectedTopic = "all";

        const topicElement = document.getElementById('current-topic');
        const letterElement = document.getElementById('current-letter');
        const textElement = document.getElementById('current-text');
        const randomToggleButton = document.getElementById('random-toggle');
        const topicSelectElement = document.getElementById('topic-select');
        const bodyElement = document.body;

        const HEBREW_LETTERS_TO_NUMBER = {
            'א': 1, 'ב': 2, 'ג': 3, 'ד': 4, 'ה': 5, 'ו': 6, 'ז': 7, 'ח': 8, 'ט': 9, 'י': 10,
            'כ': 20, 'ל': 30, 'מ': 40, 'נ': 50, 'ס': 60, 'ע
